extends ../../layouts/default.pug
include ../../mixins/alert.pug
block main 
    +alert-success(5000)
    h1(class="mb-4") Chat
    include ../../partials/list-btn-user.pug


    .card.shadow-sm(style="max-width:600px;margin:auto; border:none; background:#fff;")
        .card-body.p-0
            // Header chat
            .d-flex.align-items-center.p-3.border-bottom.bg-white(style="border-radius:8px 8px 0 0;")
                img(src=opponent.avatar, alt="Avatar", width="40", height="40", class="rounded-circle me-2")
                .fw-bold.fs-5.text-dark #{opponent.fullName}
            // Chat box
            #chat-box(style="height:350px;overflow-y:auto;background:#e5ddd5;padding:20px 16px;border-radius:0 0 8px 8px;")
                each chat in chats 
                    .d-flex.mb-2
                        if chat.infoUser.userId === userId
                            .bg-primary.text-white.p-2.rounded.shadow-sm.ms-auto(style="max-width:70%")
                                span #{chat.content}
                            span.me-2.align-self-end.text-muted.fs-7 #{chat.createdAt.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', hour12: false })}
                        else
                            img(src=chat.infoUser.avatar || '/images/user-avatar.png', alt=chat.infoUser.fullName, width="30", height="30", class="rounded-circle me-2")
                            .bg-white.p-2.rounded.shadow-sm.me-auto(style="max-width:70%")
                                span.text-dark #{chat.content}
                            span.ms-2.align-self-end.text-muted.fs-7 #{chat.createdAt.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', hour12: false })}
            #typing-status.text-muted.fs-7.ps-2.pb-2
            // Input chat
            form(class="inner-form", action="", style="display:flex;gap:8px;align-items:center;padding:16px;background:#fff;border-top:1px solid #eee;")
                input(
                    type="text",
                    name="content",
                    placeholder="Nhập tin nhắn...",
                    style="flex:1; padding:12px 16px; border-radius:20px; border:1px solid #ccc; background:#f0f2f5; outline:none; font-size:16px; transition:border-color 0.2s;"
                )
                span(id="emoji-btn", style="cursor:pointer;")
                    i.fas.fa-smile(style="font-size:20px; color:#0084ff; cursor:pointer;")
                    emoji-picker(
                        style=" position:absolute; bottom:60px; right:16px; z-index:1000;"
                    )
                button.btn.btn-primary.rounded-circle.ms-2(
                    style="width:44px;height:44px;display:flex;align-items:center;justify-content:center;background:#0084ff;border:none;box-shadow:none;"
                    type="submit"
                )
                    i.fas.fa-paper-plane(style="font-size:18px;")
                
    
    script.
        window.userId = '!{userId}';
        window.opponent = !{JSON.stringify(opponent)};